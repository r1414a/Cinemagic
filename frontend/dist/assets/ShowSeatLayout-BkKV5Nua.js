import{g as T,m as $,b as A,r as u,u as b,f as F,j as e,L as V,N as H,k as P}from"./index-B8z_zBDs.js";import{G as y,i as B}from"./index-CDTVc3k6.js";import{h as g}from"./moment-C5S46NFB.js";import{a as k}from"./allapis-VSAyny7H.js";function j(i){return y({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M16 3H8C5.79086 3 4 4.79086 4 7V8C6.76142 8 9 10.2386 9 13H15C15 10.2386 17.2386 8 20 8V7C20 4.79086 18.2091 3 16 3ZM20 10C18.3431 10 17 11.3431 17 13V16H15V15H9V16H7V13C7 11.3431 5.65685 10 4 10C2.34315 10 1 11.3431 1 13C1 14.3062 1.83481 15.4175 3 15.8293V21H5V20H19V21H21V15.8293C22.1652 15.4175 23 14.3062 23 13C23 11.3431 21.6569 10 20 10Z"},child:[]}]})(i)}function E(i){return y({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 10v-4a3 3 0 0 1 .128 -.869m2.038 -2.013c.264 -.078 .544 -.118 .834 -.118h8a3 3 0 0 1 3 3v4"},child:[]},{tag:"path",attr:{d:"M16.124 12.145a3 3 0 1 1 3.756 3.724m-.88 3.131h-14v-3a3 3 0 1 1 3 -3v2"},child:[]},{tag:"path",attr:{d:"M8 12h4"},child:[]},{tag:"path",attr:{d:"M7 19v2"},child:[]},{tag:"path",attr:{d:"M17 19v2"},child:[]},{tag:"path",attr:{d:"M3 3l18 18"},child:[]}]})(i)}function O(){const o=T().id,[n]=$(),d=n.get("showtimeID"),f=n.get("theater"),r=JSON.parse(f),m=n.get("city"),p=n.get("time"),x=n.get("date"),v=A(),[a,S]=u.useState([]),{details:c,isLoading:C}=b(s=>s.movie),[N,M]=u.useState(null);if(console.log(d,r,p,m,x),u.useEffect(()=>{console.log("fetchShowTimesFromDB");const s=async()=>{const l=await k("/api/movies/showtime/reservations","POST",{showtimeID:d},"Error getting reservations for showtime form db.",h=>{M(h.data)});console.log(l)};c.length!=0&&s()},[c]),u.useEffect(()=>{console.log("dispatch"),v(F(o))},[v]),c.length===0||C||N==null)return e.jsx(V,{});const D=s=>{console.log(s.currentTarget.dataset.seatlocation);const l=s.currentTarget.dataset.seatlocation;S(h=>h.includes(l)||N.reservedSeats.includes(l)?h.filter(t=>t!==l):[...h,l])};return console.log(c,a),e.jsx(e.Fragment,{children:e.jsxs("section",{className:"relative min-h-screen",style:{backgroundImage:`url(http://image.tmdb.org/t/p//original${c[0].backdrop_path})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center center"},children:[e.jsx("div",{className:"absolute w-full z-10 h-full bg-radial-[at_50%_50%] from-transparent to-black to-0% opacity-[0.8] "}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center  z-30",children:e.jsxs("div",{className:" w-full max-w-6xl px-6 lg:px-10 py-32 rounded-md flex flex-col md:flex-row",children:[e.jsxs("div",{className:" relative w-full md:w-[70%] space-y-12",children:[e.jsx(H,{to:`/movie/book/${c[0].id}`,children:e.jsxs("button",{className:"absolute top-0 text-white font-semibold flex items-center gap-3 cursor-pointer hover:text-dyellow",children:[e.jsx(B,{}),"back"]})}),e.jsx("div",{children:e.jsxs("ul",{className:"flex justify-center gap-8",children:[e.jsxs("li",{className:"flex gap-2 items-center text-white",children:[e.jsx(j,{className:"text-cream"}),"Available"]}),e.jsxs("li",{className:"flex gap-2 items-center text-white",children:[e.jsx(j,{className:"text-gray"}),"Sold"]}),e.jsxs("li",{className:"flex gap-2 items-center text-white",children:[e.jsx(j,{className:"text-dyellow"}),"Selected"]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"space-y-2",children:["X","A","B","C","D","E","F","G","H"].map((s,l)=>e.jsx("div",{className:"flex gap-2",children:[...Array(13)].map((h,t)=>e.jsx("div",{className:`${t===4||t===8?"me-18":t===0?"me-6 ":null} text-sm text-center`,children:t===0?e.jsx("p",{className:"text-white",children:s}):l>0?e.jsx("div",{onClick:D,"data-seatlocation":`${s}-${t}`,className:"w-5 h-5 cursor-pointer",children:e.jsx(j,{className:`w-full h-full text-xl text-cream ${a.includes(`${s}-${t}`)?"text-dyellow":N.reservedSeats.includes(`${s}-${t}`)?"text-gray":"text-cream hover:text-dyellow"} `})}):e.jsx("div",{className:"w-5 h-5",children:e.jsx("p",{className:"text-white",children:t})})},t))},s))})}),e.jsxs("div",{className:"",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mx-auto w-[360px] lg:w-[550px] h-[] lg:h-[50px] rotate-180",viewBox:"0 0 704 60",fill:"none",children:e.jsx("path",{d:"M2 57.3338C2 57.3338 80.3312 3.00071 352 3C623.669 2.99929 702 57.3338 702 57.3338",stroke:"white",strokeWidth:"4"})}),e.jsx("p",{className:"mt-4 text-center text-white text-sm",children:"All eyes this way please."})]})]}),e.jsxs("div",{id:"showSeatLayoutTicket",className:"w-full md:w-[30%] bg-dyellow rounded-md",children:[e.jsx("div",{className:"p-3 border-b-3 border-dashed",children:e.jsx("h1",{className:"text-xl text-center",children:"TICKETS"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"px-6 space-y-2",children:[e.jsxs("h1",{className:"text-sm font-medium",children:[c[0].original_title," -"," ",e.jsx("span",{className:"text-xs",children:g(c[0].release_date).format("DD MMM YY")})]}),e.jsxs("p",{className:"text-sm",children:[r.chain," | ",r.name," |"," ",r.location," | ",m]}),e.jsx("p",{className:"text-sm",children:g.unix(p).format("dddd, MMMM Do YYYY, hh:mm A")})]})}),e.jsx("div",{className:`${a.length===0?"px-6":"px-0"}`,children:a.length===0?e.jsxs("div",{className:"flex flex-col justify-center items-center h-48 rounded-md bg-blue text-white  gap-3 px-6 py-4",children:[e.jsx(E,{className:"text-3xl"}),e.jsx("p",{className:"text-md",children:"No seat selected."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 h-16 space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Seat Info:"}),e.jsx("div",{className:"space-x-1",children:a.length>5?e.jsxs("div",{className:"flex items-center gap-2",children:[[...Array(5)].map((s,l)=>e.jsx("div",{className:"p-1 rounded-md inline-block text-white bg-gray",children:e.jsx("p",{className:"text-xs",children:a[l]})},s)),e.jsxs("p",{className:"text-xs",children:["& ",a.length-5," more"]})]}):a.map(s=>e.jsx("div",{className:"p-1 rounded-md inline-block text-white bg-gray",children:e.jsx("p",{className:"text-xs",children:s})},s))})]}),e.jsxs("div",{className:"px-6 space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Payment Details:"}),g().subtract(5,"days").unix()<g(c[0].release_date).unix()?e.jsx(w,{seat:a,price:500,showtimeID:d,theater:r,city:m}):e.jsx(w,{seat:a,price:250,showtimeID:d,theater:r,city:m})]})]})})]})]})})]})})}function w({seat:i,price:o,theater:n,city:d,showtimekiID:f}){const{userProfile:r}=b(x=>x.user);console.log(r);const m=P(),p=async()=>{const x=await k("/api/movies/bookMovie","POST",{showtimekiID:f,seat:i,theater:n,city:d,email:r.email,price:o},"Error while making a reservation.",v=>{m("/movie/book/success")});console.log(x)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("p",{className:"text-sm",children:[i.length," X ",o]}),e.jsxs("p",{children:["â‚¹",i.length*o]})]}),e.jsx("div",{className:"my-6 h-1 w-full border-b-2 border-dashed"}),e.jsx("div",{className:"px-6 text-center",children:e.jsxs("button",{onClick:p,className:"cursor-pointer w-full text-sm bg-blue text-white py-3 px-6 rounded-md",children:["Grand Total: Rs ",i.length*o]})})]})}export{O as default};
